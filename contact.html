<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact | First Principle Asset Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- HEADER / NAV -->
    <header class="header">
        <nav class="nav container">
            <a href="index.html" class="logo">First Principle</a>
            <ul class="nav-links">
                <li><a href="about.html">About</a></li>
                <li class="nav-item-with-dropdown">
                    <a href="product.html">Strategy</a>
                    <ul class="nav-dropdown">
                        <li><a href="product.html#core-strategies">Core Strategies</a></li>
                        <li><a href="product.html#portfolio-optimization">Portfolio Optimization</a></li>
                        <li><a href="product.html#first-principle-framework">The First Principle Framework</a></li>
                        <li><a href="product.html#behavior-across-markets">Behavior Across Markets</a></li>
                        <li><a href="product.html#implementation-for-advisors">Implementation for Advisors</a></li>
                    </ul>
                </li>
                <li><a href="simulator.html">Portfolio Simulator</a></li>
                <li><a href="resources.html">Resources</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
            <a href="contact.html" class="cta-button">Advisor Inquiry</a>
        </nav>
    </header>

    <main>
        <!-- CONTACT SECTION -->
        <section class="contact-section-new">
            <div class="container">
                <div class="contact-content-new">
                    <div class="contact-text-new fade-on-scroll">
                        <h2 class="contact-title">Partner With First Principle</h2>
                        <p class="contact-subtitle">We collaborate with advisors who value institutional-grade structured solutions. Share a few details and our team will follow up.</p>
                    </div>
                    <div class="contact-form-panel fade-on-scroll delay-1">
                        <form class="contact-form-new" id="contactForm">
                            <div class="form-group-new">
                                <label for="name">Name <span class="required">*</span></label>
                                <input type="text" id="name" name="name" required>
                                <span class="error-message" id="nameError"></span>
                            </div>
                            <div class="form-group-new">
                                <label for="company">Company</label>
                                <input type="text" id="company" name="company">
                            </div>
                            <div class="form-group-new">
                                <label for="email">Email <span class="required">*</span></label>
                                <input type="email" id="email" name="email" required>
                                <span class="error-message" id="emailError"></span>
                            </div>
                            <div class="form-group-new">
                                <label for="message">Message <span class="required">*</span></label>
                                <textarea id="message" name="message" rows="5" required></textarea>
                                <span class="error-message" id="messageError"></span>
                            </div>
                            
                            <!-- Success/Error Messages -->
                            <div class="form-message" id="formMessage" role="alert" aria-live="polite"></div>
                            
                            <button type="submit" class="btn-contact" id="submitButton">
                                <span class="button-text">Submit Inquiry</span>
                                <span class="button-loader" style="display: none;">Sending...</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="container">
            <p>First Principle Asset Management · An Invictus Collective Company · Chicago, IL</p>
        </div>
    </footer>

    <script>
        // Scroll animation observer
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                }
            });
        }, { threshold: 0.1, rootMargin: '0px 0px -100px 0px' });

        document.querySelectorAll('.fade-on-scroll').forEach(el => {
            observer.observe(el);
        });

        // Contact Form Handler
        (function() {
            const form = document.getElementById('contactForm');
            const submitButton = document.getElementById('submitButton');
            const buttonText = submitButton.querySelector('.button-text');
            const buttonLoader = submitButton.querySelector('.button-loader');
            const formMessage = document.getElementById('formMessage');
            
            // Helper function to show error messages
            function showError(fieldId, message) {
                const errorElement = document.getElementById(fieldId + 'Error');
                const field = document.getElementById(fieldId);
                if (errorElement) {
                    errorElement.textContent = message;
                    errorElement.style.display = 'block';
                }
                if (field) {
                    field.classList.add('error');
                }
            }

            // Helper function to clear error messages
            function clearErrors() {
                document.querySelectorAll('.error-message').forEach(el => {
                    el.textContent = '';
                    el.style.display = 'none';
                });
                document.querySelectorAll('.form-group-new input, .form-group-new textarea').forEach(el => {
                    el.classList.remove('error');
                });
                formMessage.textContent = '';
                formMessage.className = 'form-message';
            }

            // Helper function to show form message
            function showMessage(message, type) {
                formMessage.textContent = message;
                formMessage.className = `form-message ${type}`;
                formMessage.style.display = 'block';
                
                // Scroll to message
                formMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }

            // Email validation
            function validateEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            // Form validation
            function validateForm() {
                clearErrors();
                let isValid = true;
                const name = document.getElementById('name').value.trim();
                const email = document.getElementById('email').value.trim();
                const message = document.getElementById('message').value.trim();

                if (!name) {
                    showError('name', 'Name is required');
                    isValid = false;
                }

                if (!email) {
                    showError('email', 'Email is required');
                    isValid = false;
                } else if (!validateEmail(email)) {
                    showError('email', 'Please enter a valid email address');
                    isValid = false;
                }

                if (!message) {
                    showError('message', 'Message is required');
                    isValid = false;
                }

                return isValid;
            }

            // Handle form submission
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Validate form
                if (!validateForm()) {
                    showMessage('Please correct the errors above.', 'error');
                    return;
                }

                // Disable submit button and show loading state
                submitButton.disabled = true;
                buttonText.style.display = 'none';
                buttonLoader.style.display = 'inline';
                clearErrors();

                // Get form data
                const formData = {
                    name: document.getElementById('name').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    company: document.getElementById('company').value.trim(),
                    message: document.getElementById('message').value.trim()
                };

                try {
                    // Determine API endpoint based on environment
                    // In production, this will be the Vercel serverless function
                    // In development, you may need to adjust the URL
                    const apiUrl = '/api/contact';
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.details || data.error || 'Failed to send message');
                    }

                    // Success
                    showMessage(data.message || 'Your message has been sent successfully. We will get back to you soon.', 'success');
                    form.reset();
                    
                    // Reset button after a delay
                    setTimeout(() => {
                        submitButton.disabled = false;
                        buttonText.style.display = 'inline';
                        buttonLoader.style.display = 'none';
                    }, 2000);

                } catch (error) {
                    console.error('Form submission error:', error);
                    showMessage(
                        error.message || 'There was an error sending your message. Please try again later or contact us directly at engage@theinvictuscollective.com.',
                        'error'
                    );
                    
                    // Re-enable submit button
                    submitButton.disabled = false;
                    buttonText.style.display = 'inline';
                    buttonLoader.style.display = 'none';
                }
            });

            // Clear errors on input
            form.addEventListener('input', function(e) {
                const fieldId = e.target.id;
                const errorElement = document.getElementById(fieldId + 'Error');
                if (errorElement) {
                    errorElement.textContent = '';
                    errorElement.style.display = 'none';
                }
                e.target.classList.remove('error');
            });
        })();
    </script>
</body>
</html>
